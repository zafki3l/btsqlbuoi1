-- HO TEN: PHAM DINH THAI - D12.48.02 - 2354800090 --

CREATE DATABASE QLBANHANG

USE QLBANHANG

-- TAO BANG CUSTOMER --
CREATE TABLE CUSTOMER 
(
	cID INT PRIMARY KEY,
	customerName VARCHAR(25),
	cAge TINYINT
)

-- TAO BANG ORDER --
CREATE TABLE ORDERR
(
	oID INT PRIMARY KEY, 
	cID INT,
	CONSTRAINT FK_ORDERR FOREIGN KEY (cID) REFERENCES CUSTOMER(cID),
	oDate DATETIME, 
	oTotalPrice INT
)

-- TAO BANG PRODUCT --
CREATE TABLE PRODUCTT
(
	pID INT PRIMARY KEY,
	pNAME VARCHAR(25),
	pPrice INT
)

-- TAO BANG ORDER DETAIL --
CREATE TABLE ORDERDETAIL
(
	oID INT,
	CONSTRAINT FK1_ORDERDETAIL FOREIGN KEY (oID) REFERENCES ORDERR(oID),
	pID INT,
	CONSTRAINT FK2_FK1_ORDERDETAIL FOREIGN KEY (pID) REFERENCES PRODUCTT(pID),
	odQTY INT
)

-- CHEN DU LIEU VAO BANG CUSTOMER --
INSERT INTO CUSTOMER(cID, customerName, cAge)
VALUES
(1, 'Minh Quan', 10),
(2, 'Ngoc Oanh', 20),
(3, 'Hong Ha', 50)

-- CHEN DU LIEU VAO BANG ORDER --
INSERT INTO ORDERR(oID, cID, oDate)
VALUES
(1, 1, '3/21/2006'),
(2, 2, '3/23/2006'),
(3, 1, '3/16/2006')

-- CHEN DU LIEU VAO BANG PRODUCT --
INSERT INTO PRODUCTT(pID, pNAME, pPrice)
VALUES
(1, 'May Giat', 3),
(2, 'Tu Lanh', 5),
(3, 'Dieu Hoa', 7),
(4, 'Quat', 1),
(5, 'Bep Dien', 2)

-- CHEN DU LIEU VAO BANG ORDER DETAIL --
INSERT INTO ORDERDETAIL(oID, pID, odQTY)
VALUES
(1, 1, 3),
(1, 3, 7),
(1, 4, 2),
(2, 1, 1),
(3, 1, 8),
(2, 5, 4),
(2, 3, 3)

-- CAP NHAP TONG TIEN CHO BANG ORDERR --
UPDATE ORDERR SET oTotalPrice = (pPrice * odQTY)
FROM ORDERR JOIN ORDERDETAIL
ON ORDERR.oID = ORDERDETAIL.oID
JOIN PRODUCTT
ON ORDERDETAIL.pID = PRODUCTT.pID

-- XEM BANG --
SELECT * FROM CUSTOMER
SELECT * FROM ORDERR
SELECT * FROM PRODUCTT
SELECT * FROM ORDERDETAIL

-- CAU 2: HIEN THI CAC THONG TIN GOM oID, oDATE, oTOTALPRICE CUA TAT CA CAC HOA DON TRONG BANG ORDER, SAP XEP GIAM DAN THEO oID --
SELECT oID, oDate, oTotalPrice 
FROM ORDERR
ORDER BY ORDERR.oID DESC

-- CAU 3: HIEN THI TEN VA GIA CUA CAC SAN PHAM CO GIA TRI LON HON 5 --
SELECT pNAME, pPrice
FROM PRODUCTT
WHERE pPrice > 5

-- CAU 4: HIEN THI DANH SACH CAC SAN PHAM LA MAY GIAT
SELECT * FROM PRODUCTT
WHERE pID = 1

-- CAU 5: HIEN THI TEN NHUNG KHACH HANG CO TUOI LON HON 18 --
SELECT CUSTOMER.customerName FROM CUSTOMER
WHERE cAge > 18

-- CAU 6: HIEN THI CHI TIET CUA TUNG HOA DON --
SELECT
	CUSTOMER.cID,
	CUSTOMER.customerName,
	CUSTOMER.cAge,
	ORDERR.oDate,
	PRODUCTT.pID,
	PRODUCTT.pNAME,
	PRODUCTT.pPrice,
	ORDERDETAIL.odQTY,
	ORDERR.oTotalPrice
FROM ORDERDETAIL
JOIN ORDERR
ON ORDERDETAIL.oID = ORDERR.oID
JOIN PRODUCTT
ON ORDERDETAIL.pID = PRODUCTT.pID
JOIN CUSTOMER
ON ORDERR.cID = CUSTOMER.cID