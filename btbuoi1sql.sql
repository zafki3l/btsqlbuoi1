CREATE DATABASE QLDIEM

USE QLDIEM

-- TAO BANG SINH VIEN --

CREATE TABLE SINHVIEN
(
	MASV NCHAR(10) PRIMARY KEY,
	HOSV NVARCHAR(50),
	TEN NVARCHAR(50),
	NS DATE,
	PHAI NCHAR(3),
	MAKHOA NCHAR(10),
	CONSTRAINT FK_SINHVIEN FOREIGN KEY(MAKHOA) REFERENCES KHOA(MAKHOA)
)

INSERT INTO SINHVIEN(MASV, HOSV, TEN, PHAI, NS, MAKHOA)
VALUES
('S001', 'Nguyen Van', 'An','Nam', '1985-10-21', 'CNTT'),
('S002', 'Dinh Van', 'Hoa','Nam', '1984-01-15', 'CNTT'),
('S003', 'Ngo Viet', 'Hung', 'Nam', '1986-12-15', 'DTVT'),
('S004', 'Nguyen Thi', 'Hong', 'Nu', '1986-02-12', 'QTKD'),
('S005', 'La Thi', 'Lan', 'Nu', '1985-08-03', 'ANVAN'),
('S006', 'Nguyen Minh', 'Hien', 'Nu', '1984-11-01', 'ANVAN'),
('S007', 'Pham Ngoc', 'Doan', 'Nam', '1986-10-10', 'DTVT')

UPDATE SINHVIEN SET HOSV = 'Nguyen Thanh' WHERE MASV = 'S007'
UPDATE SINHVIEN SET TEN = 'Son' WHERE MASV = 'S007'
UPDATE SINHVIEN SET PHAI = 'Nam' WHERE MASV = 'S007'

UPDATE SINHVIEN SET MAKHOA = 'CNTT' WHERE MASV = 'S006'

-- TAO BANG KHOA --

CREATE TABLE KHOA
(
	MAKHOA NCHAR(10) PRIMARY KEY,
	TENKHOA NVARCHAR(50)
)

INSERT INTO KHOA(MAKHOA, TENKHOA)
VALUES
('ANVAN', 'Khoa Anh Van'),
('CNTT', 'Khoa Cong nghe thong tin'),
('DTVT', 'Khoa Dien tu vien thong'),
('QTKD', 'Khoa Quan tri kinh doanh')

-- TAO BANG MON HOC --

CREATE TABLE MONHOC
(
	MAMH CHAR(10) PRIMARY KEY,
	TENMH NVARCHAR(50),
	SOTIET NUMERIC(18,0)
)

INSERT INTO MONHOC(MAMH, TENMH, SOTIET)
VALUES
('AV', 'Anh van', 45),
('CSDL', 'Co so du lieu', 45),
('KTLT', 'Ky thuat lap trinh', 60),
('KTTC', 'Ke toan tai chinh', 45),
('TCC', 'Toan cao cap', 60),
('THVP', 'Tin van phong', 30),
('TTNT', 'Tri tue nhan tao', 60)

UPDATE MONHOC SET SOTIET = 50 WHERE MAMH = 'TTNT'

-- TAO BANG KET QUA --

CREATE TABLE KETQUA
(
	MASV NCHAR(10),
	CONSTRAINT FK_KETQUA1 FOREIGN KEY(MASV) REFERENCES SINHVIEN(MASV),
	MAMH CHAR(10),
	CONSTRAINT FK_KETQUA2 FOREIGN KEY(MAMH) REFERENCES MONHOC(MAMH),
	LANTHI INT,
	DIEM DECIMAL(18,0)
)

ALTER TABLE KETQUA
ALTER COLUMN MASV NCHAR(10) NOT NULL
ALTER TABLE KETQUA
ALTER COLUMN MAMH CHAR(10) NOT NULL
ALTER TABLE KETQUA
ALTER COLUMN LANTHI INT NOT NULL

ALTER TABLE KETQUA
ADD CONSTRAINT PK_KETQUA PRIMARY KEY (MASV, MAMH, LANTHI)

INSERT INTO KETQUA(MASV, MAMH, LANTHI, DIEM)
VALUES
('S001', 'CSDL', 1, 4.0),
('S001', 'TCC', 1, 6.0),
('S002', 'CSDL', 1, 3.0),
('S002', 'CSDL', 2, 6.0),
('S003', 'KTTC', 1, 5.0),
('S004', 'AV', 1, 8.0),
('S004', 'THVP', 1, 4.0),
('S004', 'THVP', 2, 8.0),
('S005', 'THVP', 1, 6.0),
('S006', 'AV', 1, 4.0),
('S006', 'AV', 2, 8.0),
('S007', 'KTLT', 1, 9.0)

INSERT INTO KETQUA(MASV, MAMH, LANTHI, DIEM)
VALUES('S001', 'KTTC', 1, 4.00)

DELETE FROM KETQUA WHERE MASV = 'S002'

-- XEM BANG --
SELECT * FROM SINHVIEN
SELECT * FROM KHOA
SELECT * FROM MONHOC
SELECT * FROM KETQUA

DROP TABLE KETQUA