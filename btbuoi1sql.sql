CREATE DATABASE QLDIEM

USE QLDIEM

-- TAO BANG SINH VIEN --

CREATE TABLE SINHVIEN
(
	MASV NCHAR(10) PRIMARY KEY,
	HOSV NVARCHAR(50),
	TEN NVARCHAR(50),
	NS DATE,
	PHAI NCHAR(3),
	MAKHOA NCHAR(10),
	CONSTRAINT FK_SINHVIEN FOREIGN KEY(MAKHOA) REFERENCES KHOA(MAKHOA)
)

-- TAO BANG KHOA --
CREATE TABLE KHOA
(
	MAKHOA NCHAR(10) PRIMARY KEY,
	TENKHOA NVARCHAR(50)
)

-- TAO BANG MON HOC --
CREATE TABLE MONHOC
(
	MAMH CHAR(10) PRIMARY KEY,
	TENMH NVARCHAR(50),
	SOTIET NUMERIC(18,0)
)

-- TAO BANG KET QUA --
CREATE TABLE KETQUA
(
	MASV NCHAR(10),
	CONSTRAINT FK_KETQUA1 FOREIGN KEY(MASV) REFERENCES SINHVIEN(MASV),
	MAMH CHAR(10),
	CONSTRAINT FK_KETQUA2 FOREIGN KEY(MAMH) REFERENCES MONHOC(MAMH),
	LANTHI INT,
	DIEM DECIMAL(18,0)
)

ALTER TABLE KETQUA
ALTER COLUMN MASV NCHAR(10) NOT NULL
ALTER TABLE KETQUA
ALTER COLUMN MAMH CHAR(10) NOT NULL
ALTER TABLE KETQUA
ALTER COLUMN LANTHI INT NOT NULL

ALTER TABLE KETQUA
ADD CONSTRAINT PK_KETQUA PRIMARY KEY (MASV, MAMH, LANTHI)

-- CHEN DU LIEU VAO BANG SINH VIEN --
INSERT INTO SINHVIEN(MASV, HOSV, TEN, PHAI, NS, MAKHOA)
VALUES
('S001', 'Nguyen Van', 'An','Nam', '1985-10-21', 'CNTT'),
('S002', 'Dinh Van', 'Hoa','Nam', '1984-01-15', 'CNTT'),
('S003', 'Ngo Viet', 'Hung', 'Nam', '1986-12-15', 'DTVT'),
('S004', 'Nguyen Thi', 'Hong', 'Nu', '1986-02-12', 'QTKD'),
('S005', 'La Thi', 'Lan', 'Nu', '1985-08-03', 'ANVAN'),
('S006', 'Nguyen Minh', 'Hien', 'Nu', '1984-11-01', 'ANVAN'),
('S007', 'Pham Ngoc', 'Doan', 'Nam', '1986-10-10', 'DTVT')

-- CHEN DU LIEU VAO BANG KHOA --
INSERT INTO KHOA(MAKHOA, TENKHOA)
VALUES
('ANVAN', 'Khoa Anh Van'),
('CNTT', 'Khoa Cong nghe thong tin'),
('DTVT', 'Khoa Dien tu vien thong'),
('QTKD', 'Khoa Quan tri kinh doanh')

-- CHEN DU LIEU VAO BANG MON HOC --
INSERT INTO MONHOC(MAMH, TENMH, SOTIET)
VALUES
('AV', 'Anh van', 45),
('CSDL', 'Co so du lieu', 45),
('KTLT', 'Ky thuat lap trinh', 60),
('KTTC', 'Ke toan tai chinh', 45),
('TCC', 'Toan cao cap', 60),
('THVP', 'Tin van phong', 30),
('TTNT', 'Tri tue nhan tao', 60)

-- CHEN DU LIEU VAO BANG KET QUA --
INSERT INTO KETQUA(MASV, MAMH, LANTHI, DIEM)
VALUES
('S001', 'CSDL', 1, 4.0),
('S001', 'TCC', 1, 6.0),
('S002', 'CSDL', 1, 3.0),
('S002', 'CSDL', 2, 6.0),
('S003', 'KTTC', 1, 5.0),
('S004', 'AV', 1, 8.0),
('S004', 'THVP', 1, 4.0),
('S004', 'THVP', 2, 8.0),
('S005', 'THVP', 1, 6.0),
('S006', 'AV', 1, 4.0),
('S006', 'AV', 2, 8.0),
('S007', 'KTLT', 1, 9.0)

-- XEM BANG --
SELECT * FROM SINHVIEN
SELECT * FROM KHOA
SELECT * FROM MONHOC
SELECT * FROM KETQUA

-- CAU 1: SUA DOI TIET MON TRI TUE NHAN TAO --
UPDATE MONHOC SET SOTIET = 50 WHERE MAMH = 'TTNT'

-- CAU 2: XOA KET QUA SINH VIEN CO MA S002 --
DELETE FROM KETQUA WHERE MASV = 'S002'

-- CAU 3: CHEN BANG KET QUA CUA SINH VIEN CO MA S001 --
INSERT INTO KETQUA(MASV, MAMH, LANTHI, DIEM) VALUES('S001', 'KTTC', 1, 4)

-- CAU 4: SUA MA SINH VIEN CO MA S007 --
UPDATE SINHVIEN
SET HOSV = 'Nguyen Thanh', TEN = 'Son', PHAI = 'Nam'
WHERE MASV = 'S007'

-- CAU 5: CHUYEN SINH VIEN CO MA S006 SANG KHOA CNTT --
UPDATE SINHVIEN SET MAKHOA = 'CNTT' WHERE MASV = 'S006'

-- CAU 6: LAY RA MA SINH VIEN, HO TEN TRONG BANG SINH VIEN --
SELECT MASV, HOSV, TEN FROM SINHVIEN

-- CAU 7: DOI TEN HIEN THI CUA COT MASV VA TEN TRONG BANG SINH VIEN --
SELECT MASV AS 'MA SINH VIEN', TEN AS 'TEN SINH VIEN'
FROM SINHVIEN

-- CAU 8: TRUY XUAT THONG TIN CUA BANG SINH VIEN --
SELECT * FROM SINHVIEN

-- CAU 9: SUA HO CUA SINH VIEN CO MA LA S002 --
UPDATE SINHVIEN SET HOSV = 'Nguyen Van' WHERE MASV = 'S002'

-- CAU 10: SUA MON ANH VAN CO SO TIET LA 60 --
UPDATE MONHOC SET SOTIET = 60 WHERE MAMH = 'AV'

-- CAU 11: LAY RA MA KHOA TEN KHOA TUONG UNG --
SELECT MAKHOA, TENKHOA
FROM KHOA

-- CAU 12: LAY RA MA SINH VIEN, TEN SINH VIEN VA DIEM THI --
SELECT SINHVIEN.MASV, TEN, DIEM
FROM KETQUA JOIN SINHVIEN
ON SINHVIEN.MASV = KETQUA.MASV

-- CAU 13: LAY RA MA SINH VIEN, TEN SINH VIEN VA TEN KHOA CUA SINH VIEN DO DANG THEO HOC --
SELECT SINHVIEN.MASV, TEN, TENMH
FROM SINHVIEN JOIN KETQUA
ON SINHVIEN.MASV = KETQUA.MASV
JOIN MONHOC 
ON KETQUA.MAMH = MONHOC.MAMH

-- CAU 14: LAY RA DU LIEU CUA 5 RECORD DAU TIEN TRONG BANG SINH VIEN --
SELECT TOP(5) * FROM SINHVIEN

-- CAU 15: LAY RA DU LIEU CUA 50% SINH VIEN TRONG BANG SINH VIEN --
SELECT TOP 50 PERCENT * FROM SINHVIEN

-- CAU 16: LAY RA SINH VIEN CO DIEM < 6 VA CO MA LA S001 --
SELECT * FROM SINHVIEN
INNER JOIN KETQUA
ON SINHVIEN.MASV = KETQUA.MASV
WHERE KETQUA.DIEM < 6 AND SINHVIEN.MASV = 'S001'

-- CAU 17: LAY RA SINH VIEN CO DIEM > 8 VA LA PHAI NAM --
SELECT * FROM SINHVIEN
INNER JOIN KETQUA
ON SINHVIEN.MASV = KETQUA.MASV
WHERE KETQUA.DIEM > 8 AND SINHVIEN.PHAI = 'Nam'

-- CAU 18: LAY RA SINH VIEN CO TUOI LON HON 35 --
SELECT * FROM SINHVIEN
WHERE YEAR(GETDATE())-YEAR(NS) > 35

-- CAU 19: LAY RA MASV, TENSV CO TUOI LON HON 37 --
SELECT MASV, TEN 
FROM SINHVIEN
WHERE YEAR(GETDATE())-YEAR(NS) > 37

-- CAU 20: DEM SO LUONG SINH VIEN KHOA CNTT --
SELECT COUNT(*) FROM SINHVIEN
JOIN KHOA
ON SINHVIEN.MAKHOA = KHOA.MAKHOA
WHERE KHOA.MAKHOA = 'CNTT'

-- CAU 21: DEM SO LUONG SINH VIEN KHONG TRUNG NHAU TRONG BANG KET QUA --
SELECT COUNT(DISTINCT MASV) FROM KETQUA

-- CAU 22: DEM SO LUONG SINH VIEN THEO NHOM TRONG BANG KET QUA --
SELECT KETQUA.MASV, COUNT(MASV) AS 'SO LUONG'
FROM KETQUA
GROUP BY MASV
