CREATE DATABASE QLBH

USE QLBH

-- TAO BANG KHACH HANG --
CREATE TABLE KHACHHANG
(
	maKH INT PRIMARY KEY,
	Ten VARCHAR(50),
	Tuoi INT,
	diaChi VARCHAR(30)
)

-- TAO BANG HOA DON --
CREATE TABLE HOADON
(
	maHD INT NOT NULL,
	maKH INT NOT NULL,
	CONSTRAINT FK_HOADON FOREIGN KEY(maKH) REFERENCES KHACHHANG(maKH),
	ngayMua DATETIME,
	tongTien INT
)

ALTER TABLE HOADON
ADD CONSTRAINT PK_HOADON PRIMARY KEY(maHD)

-- TAO BANG SAN PHAM --
CREATE TABLE SANPHAM
(
	maSP INT PRIMARY KEY,
	tenSP VARCHAR(30),
	Gia INT
)

-- TAO BANG CHITIETHOADON --
CREATE TABLE CHITIETHOADON
(
    maHD INT NOT NULL,
    maSP INT NOT NULL,
    soLuong INT,
	CONSTRAINT FK1_CHITIETHOADON FOREIGN KEY(maSP) REFERENCES SANPHAM(maSP),
	CONSTRAINT FK2_CHITIETHOADON FOREIGN KEY(maHD) REFERENCES HOADON(maHD)
)

ALTER TABLE CHITIETHOADON
ADD PRIMARY KEY (maHD, maSP)

-- CHEN DU LIEU VAO BANG --
INSERT INTO KHACHHANG(maKH, Ten, Tuoi, diaChi)
VALUES
(1, 'Le Minh Quan', 30, 'HaNoi'),
(2, 'Pham Ngoc Oanh', 20, 'Nam Dinh'),
(3, 'Le Hong Ha', 50, 'Ha Nam'),
(4, 'Nguyen Thu Trang', 20, 'Ha Noi'),
(5, 'Le Thu Hang', 35, 'Ha Noi'),
(6, 'Nguyen Anh Tai', 25, 'Ha Noi'),
(7, 'Pham Thu Ha', 18, 'Nam Dinh'),
(8, 'Le Van Tuan', 17, 'Phu Tho'),
(9, 'Nguyen Thi Duyen', 28, 'Phu Tho'),
(10, 'Dao Thu Lan', 31, 'Ha Noi')

INSERT INTO HOADON(maHD, maKH, ngayMua, tongTien)
VALUES
(1, 1, '2021-03-21', 0),
(2, 2, '2021-03-23', 0),
(3, 1, '2021-03-16', 0),
(4, 1, '2021-03-16', 0),
(5, 1, '2021-03-20', 0)

INSERT INTO SANPHAM(maSP, tenSP, Gia) 
VALUES
(1, 'May Giat', 3),
(2, 'Tu Lanh', 5),
(3, 'Dieu Hoa', 7),
(4, 'Quat', 1),
(5, 'Bep Dien', 2)

INSERT INTO CHITIETHOADON(maHD, maSP, soLuong)
VALUES
(1, 1, 3),
(1, 3, 7),
(1, 4, 1),
(2, 1, 3),
(2, 5, 4),
(3, 1, 8)

-- XEM BANG --
SELECT * FROM KHACHHANG
SELECT * FROM HOADON
SELECT * FROM SANPHAM
SELECT * FROM CHITIETHOADON

-- CAU 1: SUA THONG TIN KHACH HANG --
UPDATE KHACHHANG SET diaChi = 'Nam Dinh' WHERE maKH = 4

-- CAU 2: THEM THONG TIN KHACH HANG -- 
INSERT INTO KHACHHANG(maKH, Ten, Tuoi, diaChi) VALUES(11, 'Pham Hai Anh', 35, 'Thai Binh')

-- CAU 3: SUA THONG TIN KHACH HANG -- 
UPDATE KHACHHANG SET Tuoi = 30 WHERE Ten = 'Le Thu Hang'

-- CAU 4: SUA MA HOA DON --
UPDATE HOADON SET ngayMua = '2022-3-21' WHERE maHD = 1

-- CAU 5: XOA KHACH HANG -- 
DELETE FROM KHACHHANG WHERE maKH = 11

-- CAU 6: LAY RA THONG TIN --
SELECT Ten, Tuoi, diaChi
FROM KHACHHANG

-- CAU 7: LAY RA THONG TIN --
SELECT maHD, CHITIETHOADON.maSP, tenSP, Gia
FROM CHITIETHOADON JOIN SANPHAM
ON CHITIETHOADON.maSP = SANPHAM.maSP

-- CAU 8: LAY 3 DU LIEU TRONG --
SELECT TOP(3) * FROM KHACHHANG

-- CAU 9: LAY RA THONG TIN KHACH HANG O NAM DINH --
SELECT * FROM KHACHHANG WHERE diaChi = 'Nam Dinh'

-- CAU 10: LAY RA KHACH HANG CO TUOI TREN 30 --
SELECT * FROM KHACHHANG WHERE diaChi = 'Ha Noi' AND tuoi>30

-- CAU 11: DEM SO LUONG KHACH HANG O Ha Noi --
SELECT COUNT(*) FROM KHACHHANG WHERE diaChi = 'Ha Noi'

-- CAU 12: DEM SO LUONG THEO NHOM --
SELECT CHITIETHOADON.soLuong, COUNT(soLuong) AS 'So Luong' 
FROM CHITIETHOADON
GROUP BY soLuong
